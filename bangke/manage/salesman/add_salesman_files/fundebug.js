!function(e){function t(e,t,r){var n=e[t];e[t]=r(n)}function r(e){return"function"!=typeof e?e:(e.__injected__||(e.__injected__=function(){try{return e.apply(this,arguments)}catch(e){throw u(e),v=!0,e}}),e.__injected__)}function n(e){var t=/^[0-9a-z]{64}$/i;return!(!e||!e.match(t))}function a(e){return e?{name:e&&e.name,message:e&&e.message,fileName:e&&e.fileName||e&&e.sourceURL,lineNumber:e&&e.lineNumber||e&&e.line,columnNumber:e&&e.columnNumber||e&&e.column}:null}function i(){var e;try{throw new Error("")}catch(t){e=t.stack}if(e)return e=e.replace(/(.*?)fundebug(.*?)\.js(.*)\n?/gm,""),e=e.replace(/^Error\n/g,""),e="generated-stack:\n"+e}function o(){for(var e,t=[],r=arguments.callee.caller.caller;r&&t.length<10;){var n=r.toString().match(/function\s*([\w\_$]+)?\s*\(/i);e=n&&n[1]||"[anonymous]",t.push(e),r=r.caller}return"generated-stack:\n"+t.join("\n")}function u(e){if(e){var t=e.stack;t=t.replace(/(.*?)fundebug(.*?)\.js(.*)\n?/gm,"");var r=a(e);d({name:r.name||"uncaught error",message:r.message,fileName:r.fileName,lineNumber:r.lineNumber,columnNumber:r.columnNumber,stacktrace:t,severity:"error",type:"uncaught"})}}function s(e){var t=[];for(var r in e)if(e.hasOwnProperty(r)){var n='"'+r+'":',a=e[r];a&&("object"==typeof a?n+=s(a):"number"==typeof a?n+=a:n=n+'"'+a.replace(/\n/g,"\\n")+'"',t.push(n))}return"{"+t.join(",")+"}"}function c(e){for(var t=[];e&&e.nodeType==Node.ELEMENT_NODE;e=e.parentNode){var r,n=0,a=!1;for(r=e.previousSibling;r;r=r.previousSibling)r.nodeType!=Node.DOCUMENT_TYPE_NODE&&r.nodeName==e.nodeName&&++n;for(r=e.nextSibling;r&&!a;r=r.nextSibling)r.nodeName==e.nodeName&&(a=!0);var i=(e.prefix?e.prefix+":":"")+e.localName,o=n||a?"["+(n+1)+"]":"";t.splice(0,0,i+o)}return t.length?"/"+t.join("/"):null}function l(e){for(var t=[];e.parentNode;){if(e.id){t.unshift("#"+e.id);break}if(e==e.ownerDocument.documentElement)t.unshift(e.tagName);else{for(var r=1,n=e;n.previousElementSibling;n=n.previousElementSibling,r++);t.unshift(e.tagName+":nth-child("+r+")")}e=e.parentNode}return t.join(" > ")}function m(e){b.push(e),b.length>20&&b.shift()}function f(t){var r,n=(r=t.target?t.target:t.srcElement)&&r.outerHTML;n&&n.length>200&&(n=n.slice(0,200)),m({type:"click",page:{url:e.location.href,title:document.title},detail:{outerHTML:n,tagName:r&&r.tagName,id:r&&r.id,className:r&&r.className,name:r&&r.name},time:(new Date).getTime()})}function p(e,t){E=t,m({type:"navigation",detail:{from:e,to:t},time:(new Date).getTime()})}function d(t){if(n(y.getAttribute("apikey")||h.apikey)&&h.maxEventNumber&&!h.silent){h.maxEventNumber-=1;var r={notifierVersion:"0.1.6",userAgent:e.navigator.userAgent,locale:e.navigator.language||e.navigator.userLanguage,url:e.location.href,title:document.title,appVersion:y.getAttribute("appversion")||h.appversion,apiKey:y.getAttribute("apikey")||h.apikey,releaseStage:y.getAttribute("releasestage")||h.releasestage,metaData:t.metaData||h.metaData,user:t.user||h.user,name:t.name,time:(new Date).getTime(),message:t.message,fileName:t.fileName,lineNumber:t.lineNumber,columnNumber:t.columnNumber,stacktrace:t.stacktrace,type:t.type,severity:t.severity,target:t.target,req:t.req,res:t.res,breadcrumbs:b};r.userAgent&&r.userAgent.match(/Googlebot/)||g(r)}}function g(t){var r;if(r="undefined"==typeof JSON?s(t):JSON.stringify(t),e.XMLHttpRequest&&e.atob){var n=new XMLHttpRequest;n.Fundebug=!0,n.open("POST","https://fundebug.com/javascript/"),n.setRequestHeader("Content-Type","application/json"),n.send(r)}else(new Image).src="https://fundebug.com/javascript?event="+encodeURIComponent(r)}var h={};e.fundebug=h;var v=!1,y=function(){var e=document.currentScript;if(!e){var t=document.scripts;e=t[t.length-1]}return e}();h.silent=y.getAttribute("silent")||!1,h.maxEventNumber=y.getAttribute("maxEventNumber")||10,h.silentResource=y.getAttribute("silentResource")||!1,h.silentHttp=y.getAttribute("silentHttp")||!1,t(e,"onerror",function(){return function(t,r,n,i,u){if(v)v=!1;else{void 0===i&&e.event&&(i=e.event.errorCharacter);var s;s=r&&r!==e.location.href?r:null;var c=a(u);d({message:t,lineNumber:n,columnNumber:i,fileName:s||c&&c.fileName,name:c&&c.name||"uncaught error",stacktrace:u&&u.stack||o(),severity:"error",type:"uncaught"})}}});var N=!0;if(e.atob){if(e.ErrorEvent)try{e.ErrorEvent.prototype.hasOwnProperty("error")&&(N=!1)}catch(e){}}else N=!1;"EventTarget Window Node ApplicationCache AudioTrackList ChannelMergerNode CryptoOperation EventSource FileReader HTMLUnknownElement IDBDatabase IDBRequest IDBTransaction KeyOperation MediaController MessagePort ModalWindow Notification SVGElementInstance Screen TextTrack TextTrackCue TextTrackList WebSocket WebSocketWorker Worker XMLHttpRequest XMLHttpRequestEventTarget XMLHttpRequestUpload".replace(/\w+/g,function(n){if(N){var a=e[n]&&e[n].prototype;a&&a.hasOwnProperty&&a.hasOwnProperty("addEventListener")&&(t(a,"addEventListener",function(e){return function(t,n,a,i){return n&&n.handleEvent&&(n.handleEvent=r(n.handleEvent)),e.call(this,t,r(n),a,i)}}),t(a,"removeEventListener",function(e){return function(t,n,a){return e.call(this,t,n,a),e.call(this,t,r(n),a)}}))}}),h.notify=function(e,t,r){if(e)return d({name:e||r&&r.name,message:t||r&&r.message,severity:r&&r.message||"warning",stacktrace:i(),type:"notification",user:r&&r.user,metaData:r&&r.metaData}),"fundebug.com"===location.host?"亲，不要在Fundebug网站测试哦；请将Fundebug插件集成到您的网站，然后进行测试!":"请查看邮箱以及Fundebug控制台!"},h.notifyError=function(e,t){if(e){var r=a(e);d({name:r.name||t&&t.name||"caught error",message:r.message||t&&t.message,stacktrace:e.stack,fileName:r.fileName,lineNumber:r.lineNumber,columnNumber:r.columnNumber,severity:t&&t.severity||"error",type:"caught",user:t&&t.user,metaData:t&&t.metaData})}},h.notifyHttpError=function(e,t,r){d({type:"httpError",req:e,res:t,user:r&&r.user,metaData:r&&r.metaData})},e.addEventListener&&e.addEventListener("unhandledrejection",function(e){h.notifyError(e.reason)}),e.addEventListener&&e.addEventListener("error",function(t){if(!h.silentResource&&!t.message){var r,n=(r=t.target?t.target:t.srcElement)&&r.outerHTML;n&&n.length>200&&(n=n.slice(0,200));var a={type:"resourceError",target:{outerHTML:n,src:r&&r.src,tagName:r&&r.tagName,id:r&&r.id,className:r&&r.className,name:r&&r.name,type:r&&r.type,XPath:c(r),selector:l(r)}};if(r.src!==e.location.href&&(!r.src||!r.src.match(/.*\/(.*)$/)||r.src.match(/.*\/(.*)$/)[1])&&a.target.src&&e.XMLHttpRequest){var i=new XMLHttpRequest;i.Fundebug=!0,i.open("HEAD",a.target.src),i.send(),i.onload=function(e){200!==e.target.status&&(a.target.status=e.target.status,a.target.statusText=e.target.statusText),d(a)}}}},!0);var b=[];e.addEventListener?e.addEventListener("click",f,!0):document.attachEvent("onclick",f);var E={url:e.location.href};document.addEventListener?document.addEventListener("DOMContentLoaded",function(){E={url:e.location.href,title:document.title}}):document.attachEvent("onreadystatechange",function(){E={url:e.location.href,title:document.title}});var T=e.onpopstate;e.onpopstate=function(){var t={url:e.location.href};if(E.title||(E.title=document.title),E.url!==t.url&&p(E,t),T)return T.apply(this,arguments)};var L=e.history.pushState;e.history.pushState=function(){E={url:e.location.href,title:document.title};var t={};if(3===arguments.length&&(t.url=arguments[2]),E.url!==t.url&&p(E,t),L)return L.apply(this,arguments)};var k=e.onhashchange;if(e.onhashchange=function(){var t={url:e.location.href,title:document.title};if(E.url!==t.url&&p(E,t),k)return k.apply(this,arguments)},e.XMLHttpRequest){var w=XMLHttpRequest.prototype;if(!w)return;var D,H,x=w.open,M=w.send;w.open=function(e,t){return D=e,H=t,x.apply(this,arguments)},w.send=function(){var t=this;t.onerror=function(e){};var r=t.onreadystatechange;return t.onreadystatechange=function(){if(4===t.readyState&&!t.Fundebug){var n={type:"XMLHttpRequest",page:{url:e.location.href},detail:{method:D,url:t.responseURL||H,status:t.status,statusText:t.statusText},time:(new Date).getTime()};if(!h.silentHttp&&2!==parseInt(t.status/100)){var a={method:n.detail.method,url:n.detail.url},i={status:t.status,statusText:t.statusText,response:t.response};h.notifyHttpError(a,i)}m(n)}r&&r.apply(this,arguments)},M.apply(this,arguments)}}if(e.fetch){var S=e.fetch;e.fetch=function(t,r){return S.apply(this,arguments).then(function(t){var n={type:"fetch",page:{url:e.location.href,title:document.title},detail:{method:r&&r.method||"GET",url:t.url,status:t.status,statusText:t.statusText},time:(new Date).getTime()};if(!h.silentHttp&&2!==parseInt(t.status/100)){var a={method:n.detail.method,url:n.detail.url},i={status:t.status,statusText:t.statusText};h.notifyHttpError(a,i)}return m(n),t})}}var R="function"==typeof define,_="undefined"!=typeof module&&module.exports;R?define(h):_&&(module.exports=h)}(window);