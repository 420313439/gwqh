<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:bangke=""><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Page-Enter" content="revealTrans(duration=5, transition=7)">
<meta name="keywords" content="邦客，琴行，管家，琴行管家，琴行软件，邦客琴行管家，琴行进销存，琴行发展，琴行扩张,琴行办公,琴行OA,琴行系统,广州琴行软件">
<meta name="description" content="琴行管家是广州骏睿信息科技有限公司，结合自身十年来对琴行需求的资深理解，将ERP的管理思想、管理流程同琴行的应用特点相结合，自主研发的一套贴身解决琴行管理问题的完整解决方案。">
<meta name="renderer" content="webkit">
<title>邦客琴行管家</title>
<!--客服固定框css-->
<link rel="icon" href="http://localhost/bangke/Public/Static/images/main/icon.png" type="image/x-icon">
<link rel="stylesheet" type="text/css" href="index_files/bootstrap.css">
<link rel="stylesheet" type="text/css" href="index_files/formBuilder.css">
<link rel="stylesheet" type="text/css" href="index_files/fullcalendar.css">
<link rel="stylesheet" type="text/css" href="index_files/consult.css">
<link rel="stylesheet" type="text/css" href="index_files/component.css">
<link rel="stylesheet" type="text/css" href="index_files/global.css">
<link rel="stylesheet" type="text/css" href="index_files/style.css">
<link rel="stylesheet" type="text/css" href="index_files/jquery_002.css">
<link rel="stylesheet" type="text/css" href="index_files/jquery-ui.css">

<link rel="stylesheet" type="text/css" href="index_files/textext_003.css">
<link type="text/css" href="index_files/textext.css" rel="stylesheet">
<link type="text/css" href="index_files/textext_002.css" rel="stylesheet">
<link type="text/css" href="index_files/textext_004.css" rel="stylesheet">

<script type="text/javascript" src="index_files/jquery-1.js"></script>
<script type="text/javascript" src="index_files/json2.js"></script>
<script type="text/javascript" src="index_files/ajaxupload.js"></script>

<link rel="stylesheet" type="text/css" href="index_files/enjoyhint.css">
<script type="text/javascript" src="index_files/enjoyhint.js"></script>
<script type="text/javascript" src="index_files/enjoyhintData.js"></script>
<script type="text/javascript" src="index_files/sender.js"></script>
<script type="text/javascript" src="index_files/jquery_003.js"></script>

<script type="text/javascript" src="index_files/hotkeys.js"></script>
<link rel="stylesheet" type="text/css" href="index_files/jquery.css">
<script type="text/javascript" src="index_files/jquery_004.js"></script>
<script type="text/javascript" src="index_files/jquery_002.js"></script>
<link rel="stylesheet" type="text/css" href="index_files/default.css"><link rel="stylesheet" type="text/css" href="index_files/emoji.css">
<style type="text/css">
    button[disabled], input[type=button][disabled], input[type=submit][disabled]{
        background:#ddd !important;
        border:1px solid #ddd;
        color:#777;
        cursor: not-allowed;
        box-shadow: none;
    }
</style>
<script type="text/javascript">
    var editor;
    var BKGlobal={};
  	$(function(){
        var explorer = window.navigator.userAgent;
        if(explorer.indexOf('Firefox')<0&&explorer.indexOf('WebKit')<0&&explorer.indexOf('Chrome')<0&&explorer.indexOf('Safari')<0&&explorer.indexOf('Opera')<0){
            alert('本系统不支持您的浏览器，请下载360浏览器使用本系统');
            location.href="http://se.360.cn/";
        }

        $.jGrowl.defaults.pool = 5;
        $.jGrowl.defaults.closerTemplate = '<div>关闭所有</div>';

        if(getCookie('is_login_first')==1){  
          if(getCookie('isAd')==1){
            if(getCookie('Adnum')!=1){
               show_ad();
            }
          }else{
             show_welcome();
          }
        }

        startMission();
        htmlInitialize();
        webSenderInitialize();
        topSearchInitialize();
        
        createImageTip();
        skinInitialize();

        adInitialize();

        $('.leftmenu').hover(function(){
            $('.leftmenu .image_tip_div').toggle();
        }); 


        checkNewsInitialize(); 

        helperInitialize(); 

        checkQueueInitialize();

        if(getCookie('IN_HS')==1){
            showHostedSignZone();
        }

        allFuncBtnInitialize();

        hotKeysInitialize();

        callNotification();

        var currentRequests = {};
        $.ajaxPrefilter(function(options, originalOptions, jqXHR){
            if(options.abortOnRetry){ // 重复提交覆盖请求
                if(currentRequests[options.url]){
                    currentRequests[options.url].abort();
                }
                currentRequests[options.url] = jqXHR;
            }else if(options.prohibitRetry){ // 禁止重复提交
                if(currentRequests[options.url]){
                    jqXHR.abort();
                }else{
                    currentRequests[options.url] = jqXHR;
                }
            }else{ // 不限制
                currentRequests[options.url] = jqXHR;
            }
            console.log("currentRequests",currentRequests);
        });
        $(document).ajaxComplete(function(event, xhr, settings){
            delete currentRequests[settings.url];
        });
    });
    (function($) {
        var formSubmit=function(form,filter,handle){
            $form=$(form);
            var params=getFormJson($form);
            if(typeof handle == "undefined"){
                handle=filter;
                filter=null;
            }
            if(filter){
                var params=filter(params);
                if(!params){
                    return false;
                }
            }
            $.ajax({
                type:$form.attr('method'), 
                url:$form.attr('action'), 
                data:params,
                prohibitRetry:true,
                beforeSend: function(xhr) {
                    submit_before_info();
                    disableForm(form, true);
                },
                complete:function(xhr, ts){
                    window.setTimeout(disableForm, 800, form, false);
                },
                success:function(data){
                    submit_back_info(data);
                    if(typeof handle != "function"){
                        if(data.status==1){
                            location.reload();
                        }
                    }else{
                        handle(data);
                    }
                }
            });
            return false;
        };

        var disableForm=function(form, disable){
            if(disable){
                $(form).find("[type=submit]").attr("disabled", disable);
            }else{
                $(form).find("[type=submit]").removeAttr("disabled");
            }
        };
        $.fn.formSubmit=function(filter,handle){
            $(this).each(function(){
                if(!$(this).data("formSubmit")){
                    $(this).on("submit",function(){
                        formSubmit(this, filter, handle);
                        return false;
                    });
                    $(this).data("formSubmit",(new Date).getTime());
                }
            });
        }
        window.formSubmit=formSubmit;
    })(jQuery);

    function callNotification(options,callback){
        if (!window.Notification) {
            console.log('浏览器不支持Notification');
            return false;
        }
        var showNotification = function(){
            if (Notification.permission == "granted") {
                var _default = {
                    "title":"【邦客】系统消息",
                    "body":"",
                    "icon":"/bangke/Public/Static/images/main/icon.png",
                    "show":true,
                };
                options = $.extend(_default, typeof options === "string" ?{body:options}:options);
                if(typeof options.show=="function" && options.show()){
                    options.show=true;
                }
                if(!options.show) return false;
                var notification = new Notification(options.title, options);
                callback && callback(notification);
            }
        }
        if (Notification.permission == "granted") {
            options && showNotification();
        } else if (Notification.permission != "denied") {
            Notification.requestPermission(function (permission) {
                options && showNotification();
            });
        }
    }

    function callFunc(func, args, defaultValue) {
        if (typeof func === 'string') {
            // support obj.func1.func2
            var fs = func.split('.');

            if (fs.length > 1) {
                func = window;
                $.each(fs, function (i, f) {
                    func = func[f];
                });
            } else {
                func = window[func];
            }
        }
        if (typeof func === 'function') {
            return func.apply(null, args);
        }
        return defaultValue;
    }

    function allFuncBtnInitialize(){
        var isHover=0;
        $('#allFuncBtn').hover(function(){
            isHover=1;
            $('#allFunc_box').show();
        },function(){
            window.setTimeout(function(){
                isHover=0;
                if(!$('#allFunc_box').is(":hover")){
                    $('#allFunc_box').hide();
                }
            },500);
        });

        $('#allFunc_box').hover('',function(){
            if(!isHover){
                $(this).hide();
            }
        });
    }

    function hotKeysInitialize(){
        hotkeys('f', function(event,handler){
            $('#searchString').focus();
            return false;
        });

        hotkeys('f1', function(event,handler){
            $('#allFunc_box').toggle();
            return false;
        });
    }

    function kEditorInitialize(options){
        var _default={
            width:'600px',
            height:'300px',
            minWidth:300,
            uploadJson:"/bangke/Manage/Upload/keUpload",
            allowFlashUpload:false,
            allowMediaUpload:false,
            allowFileUpload:false,
            allowFileManager:false,
            afterChange: function() {
                this.sync();
            },
            items:['formatblock', 'fontsize', '|', 'forecolor', 'hilitecolor', 'bold','italic', 'underline', 'lineheight', 'removeformat', '|','justifyleft', 'justifycenter', 'justifyright','justifyfull', 'insertorderedlist', 'insertunorderedlist', '|',  'fullscreen', '/', 'image', 'emoticons', '|','clearhtml','source', 'preview']
        };

        var editor = KindEditor.create('.text_editor', $.extend(_default,options||{}));
        return editor;
    }

    function showHostedSignZone(){
        showTBox("TitleClose","/bangke/Manage/Booking/hostedSign","100vw,100vh","","","","",{maskclose:0,close:0,class:"tbox_unlimit",top:0,left:0});
    }

    //cookie控制各个页面第一次访问时跳出新手指导，如果有的话。
    function helperInitialize(key,callback){
        var key=key||(getFCL('CheckStand')+'-'+getFCL('checkStand'));
        if(getCookie('NewbieGuideDone')){
            var doneStr=getCookie('FirstGuideDone')||'';
            if(doneStr.indexOf(key)==-1){
                if(callback){
                    callback(doneStr,key);
                }else if(typeof(tutorial)=='function'){
                    doneStr+='#'+key;
                    setCookie('FirstGuideDone',doneStr,3600);
                    tutorial();
                }
            }
        }
    }

    //获得首中尾字符
    function getFCL(str){
        var l=str.length;
        if(l%2==0){
            return str.substr(0,1)+str.substr(l/2-1,2)+str.substr(-1,1);
        }else{
            return str.substr(0,1)+str.substr(l/2-0.5,1)+str.substr(-1,1);
        }
    }

    function checkQueueInitialize(){
        if(BKGlobal.delayQueue===undefined){
            BKGlobal.delayQueue=$.delayQueue({interval:20000});
        }
        BKGlobal.checkQueueTimer=$.timer(10000, function(){
            // if(document.domain!='localhost'){
                checkQueue();
            // }
        });
    }

    function queueLocalization(queue){
        if(queue){
            setCookie('queue',JSON.stringify(queue));
        }else{
            var t=getCookie('queue');
            t=t?JSON.parse(t):[];
            return t;
        }
    }

    function getQueue(){
        var queue=BKGlobal.queue;
        if(!queue){
            setQueue();
            queue=BKGlobal.queue;
        }
        var thing=queue.shift();
        if(!thing&&queue.length==0){
            if(setQueue()){
                return getQueue();
            }else{
                return '';
            }
        }
        return thing;
    }

    function setQueue(thing,delay){  
        if(!thing){
            if(BKGlobal.queue===undefined){
                BKGlobal.queue=queueLocalization();
                return true;
            }else{
                return false;
            }
        }else{
            if(delay>0){ //推迟
                BKGlobal.queue.push(delay+"#"+thing);
            }else if(delay==0){  //完成

            }
            queueLocalization(BKGlobal.queue);
        }
    }

    function checkQueue(thing){
        var thing=thing?thing:getQueue();
        if(!thing){
            BKGlobal.checkQueueTimer.pause(); //暂停
        }
        if(thing.indexOf('_')==-1){
            return ;
        }
        if(thing.indexOf('#')>0){
            var t=thing.split('#')[0];
            if(t==-1){  //-1为停止该任务
                return ;
            }
            thing=thing.split('#')[1];
            BKGlobal.delayQueue.add(t,"checkQueue('"+thing+"')");
            setQueue(thing,0); 
            return ;
        }
        BKGlobal.checkQueueTimer.pause(); //暂停
        window[thing.split("_")[0]](thing.split("_")[1],function(res){
            setQueue(thing,res);
            BKGlobal.checkQueueTimer.resume();  //恢复
        });
    }

    function queueFunc(type,callback){
        $.ajax({
            type:'GET',
            url:"/bangke/Manage/BaseData/checkQueue",
            data:{type:type},
            error:function(XMLHttpRequest, textStatus, errorThrown){
                callback&&callback(1); //推迟一分钟执行
            },
            success:function(data){
                if(data.status==0){
                    callback&&callback(1);  //推迟一分钟执行
                }else{  //有任务，提醒用户
                    TINY.box.reset();
                    showTBox('待办事项','','500px',data,function(){
                        if(typeof(tboxPageInit)=='function'){
                            tboxPageInit(callback);
                        }else{
                            getResult(callback);
                        }
                    },function(){
                        callback&&callback(1);  //推迟一分钟
                    });
                }
            }
        });
    }

    function getPushedNotes(data){
        var args=$.parseJSON(data)||data;
        showNotification(args.msg,args);
    }

    function showNotification(msg,options){
        var _default={
            sticky: true,
            click: function(self) {
                log('..');
            }
        };
        if(options!==undefined&&options.url!==undefined){
            _default.click=function(self){
                location.href=options.url;
            }
        }
        var options = $.extend(_default, options||{});
        $.jGrowl(msg, options);
        callNotification({
            body:msg,
            tag:new Date().getTime(),
            vibrate:[200, 100, 200]
        },function(notification){
            notification.onclick=function(){
                notification.close();
            }
        });
    }

    function showShortMsg(type,args){
        var html,title;
        log(args);
        args=args?JSON.parse(args):{};
        switch(type){
            case "serviceOver":
                title="服务结束提醒";
                html="<p class='short_msg'>温馨提示："+args.stu_name+"签到的"+args.sv_name+"服务已经结束了！</p>";
                break;
            case "classOver":
                title="课程结束提醒";
                html="<p class='short_msg'>温馨提示："+args.stu_name+"签到的"+args.c_name+"课程已经结束了！</p>";
                break;
            default:;
        } 
        if(html){
            var time=nowDateTime();
            storageOperator('shortMsg',{'title':title,'html':html,'time':time});
            TINY.box.reset();
            showTBox(title,'','400px',html,'','','',{autohide:6});
            showNotification(html);
        }
    }

    function showShortMsgList(){
        var list=storageOperator('shortMsg');
        var html="<div class='short_msg_list'>";
        for(i in list){
            html+="<dl>"+list[i]['title']+"【"+list[i]['time']+"】："+list[i]['html']+"</dl>";
        }
        html+="</div>";
        showTBox('通知','','500px',html,'','');
    }

    function storageOperator(name,value,max){ //储存为list数组
        if(!window.localStorage){
            console.error('该浏览器不支持本地存储');
            return false;
        }
        var storage=window.localStorage;
        if(value){
            var o=storage.getItem(name);
            o=o?JSON.parse(o):[];
            if(value=='[remove]'){
                if(max){
                    o.splice(max,1);
                    storage.setItem(name,JSON.stringify(o));
                }else{
                    storage.removeItem(name);
                }
            }else{
                o.unshift(value);
                max=max||10;
                if(o.length>max){ //只保留max条记录
                    o.splice(0,o.length-max);
                }
                storage.setItem(name,JSON.stringify(o));
            }
        }else{
            var o=storage.getItem(name);
            return o?JSON.parse(o):[];
        }
    }

    function storageObjOperator(name,key,value){ //储存为对象
        if(!window.localStorage){
            console.error('该浏览器不支持本地存储');
            return false;
        }
        var storage=window.localStorage;
        if(key){
            var o=storage.getItem(name);
            o=o?JSON.parse(o):{};
            if(key=='[remove]'){
                storage.removeItem(name);
            }else{
                o[key]=value;
                storage.setItem(name,JSON.stringify(o));
            }
        }else{
            var o=storage.getItem(name);
            return o?JSON.parse(o):{};
        }
    }

    function logCallBack(str,callback){
        log(str);
        var r=prompt(str,'1');
        if(!r){
            var r=0;
        }
        callback&&callback(r);
    }

    function checkNewsInitialize(){
        BKGlobal.checkNewsTimer=$.timer(10000, function(){
            if(document.domain!='localhost'){
                checkNews();
            }
        });
    }

    function checkUrl($url){
        if($url.indexOf("http://")==-1&&$url.indexOf("https://")==-1){
            $url="/bangke/"+$url;
        }
        return $url;
    }

    function removeHTMLTag(str,_default) {
        str = str.replace(/<\/?[^>]*>/g,''); //去除HTML tag
        str = str.replace(/[ | ]*\n/g,'\n'); //去除行尾空白
        //str = str.replace(/\n[\s| | ]*\r/g,'\n'); //去除多余空行
        str=str.replace(/ /ig,'');//去掉 
        return str?str:(_default || '');
    }

    function showMsgBox(data){
        callNotification({
            title:data.nickname,
            body:data.value.type=='text'?removeHTMLTag(data.value.msg,'给你发来了新消息'):'给你发来了新消息',
            tag:'WECHAT_MSG',
            icon:data.headimgurl,
            data:data,
            vibrate:[200, 100, 200],
            renotify:true
        },function(notification){
            notification.onclick=function(){
                window.focus();
                notification.close();
            };
        });
        var html=$('#webMsg_box').html();
        if(data.value.type!==undefined){
            if(data.value.type=='image'){
                msg="<img src='"+checkUrl(data.value.msg)+"' alt='图片已过期' />";
            }else if(data.value.type=='video'){
                msg="<video preload='auto' src='"+checkUrl(data.value.msg)+"' controls></video>";
            }else if(data.value.type=='voice'){
                msg="<a href='"+checkUrl(data.value.msg)+"' target='_blank'><span class='glyphicon glyphicon-volume-up'></span>下载播放语音</a>";
            }else{
                msg=data.value.msg;
            }
        }else{
            msg=data.value.msg;
        }
        if("checkStand"=='index'&&'CheckStand'=='Index'){
            return false;
        }
        html=html.replace('_HEADIMGURL_',data.headimgurl).replace('_NICKNAME_',data.nickname).replace('_MSG_',msg).replace('_DATE_',formatDateTime(data.value.time+'000').slice(0,-3));
        if($('.tbox_msg:visible').length>0){
            $('.tbox_msg .popwin_content').html(html);
            $('.tbox_msg .headImg').attr("src",$('.tbox_msg .headImg').attr("data-src"));
            $('.tbox_msg #reply_btn').off('click');
            $('.tbox_msg #reply_btn').on('click',function(){
                var reply=$('.tbox_msg #reply').val();
                var preMsg=JSON.stringify(data.value);
                $.ajax({
                    type:'POST', //表单提交类型
                    url:"/bangke/Manage/WebMsg/replyToUser", //表单提交目标
                    data:{'reply':reply,'preMsg':preMsg},
                    success:function(data){
                        alertInfo(data.info);
                        if(data.status==1){
                            TINY.box.hide();
                        }
                    }
                });
            });  
        }else{
            if($('.tbox:visible').not(".tbox_msg").length>0){
                TINY.box.reset();
            }
            showTBox("微信信息",'','450px',html,function(){
                $('.tbox_msg .headImg').attr("src",$('.tbox_msg .headImg').attr("data-src"));
                $('.tbox_msg #reply_btn').on('click',function(){
                    var reply=$('.tbox_msg #reply').val();
                    var preMsg=JSON.stringify(data.value);
                    $.ajax({
                        type:'POST', //表单提交类型
                        url:"/bangke/Manage/WebMsg/replyToUser", //表单提交目标
                        data:{'reply':reply,'preMsg':preMsg},
                        success:function(data){
                            alertInfo(data.info);
                            if(data.status==1||data.resultdata==1){
                                TINY.box.hide();
                            }
                        }
                    });
                });  
            },'','',{
                top:0,class:"tbox_msg",mask:0
            });
        }
    }

    function getPushedNews(data){
        player("/bangke/Public/Static/mp3/newMsg");
        // showMsgBox($.parseJSON(data));
        data=$.parseJSON(data)||data;
        showMsgBox(data);
        if(typeof(showMsgNote)=='function'){
            showMsgNote();
        }else{
            $('#wechatNewsCount').show();
            setCookie('__news',1);
            showNewsTitle();
        }
        BKGlobal.checkNewsTimer.reset(10000);
    }

    function player(musicSrc){
        var str="<audio controls autoplay class='muc'><source src="+musicSrc+".OGG type='audio/ogg'><source src="+musicSrc+".mp3 type='audio/mpeg'>Your browser does not support the audio element.</audio>"
        $('#player').html('');
        $('#player').html(str);  
    }

    function checkNews(){
        $.ajax({
            type:'POST',
            url:"/bangke/Manage/WebMsg/checkNewMsg",
            success:function(data){
                if(data.status==1){
                    if(typeof(showMsgNote)=='function'){
                        showMsgNote();
                    }else{
                        $('#wechatNewsCount').show();
                        setCookie('__news',1);
                        showNewsTitle();
                    }
                    BKGlobal.checkNewsTimer.reset(10000);
                }else{
                    var t=2*BKGlobal.checkNewsTimer.interval;
                    BKGlobal.checkNewsTimer.reset(t<300000?t:300000);
                    $('#wechatNewsCount').hide();
                    setCookie('__news',0);
                }
            }
        });
    }

    function showNewsTitle(){
        if(BKGlobal.showNewsTimer){
            BKGlobal.showNewsTimer.stop();
        }
        BKGlobal.showNewsTimer=$.timer(1000, function(timer){
            var t="邦客琴行管家";
            if(getCookie('__news')==1){
                if(timer.runtimes==undefined){timer.runtimes=1}
                var k=timer.runtimes;
                document.title=(k%2==0? "【　　　】":"【新消息】")+t;
                timer.runtimes++;
            }else{
                timer.stop();
                document.title=t;
            }
        });
    }

    function showPrintBtn(type){
        if(type&&type.indexOf('tbox')!=-1){
            if($('.tbox').find('.list').length>0){
                if($('.tbox .popwin_title').find('.a_print').length>0){
                    return true;
                }else{
                    var str="<a class='a_print vip vip_func' style='margin-right: 40px;' href='javascript:void(0)' onclick=\"printPreview('.tbox .list',this)\">打印</a>";
                    $('.tbox .popwin_title').append(str);
                }
            }
        }else{
            if($('.right').find('.list').length>0){
                $('.right .list').each(function(){
                    if($(this).find('.a_print,.btn_print').length>0||$(this).find('table').length==0){
                        return true;
                    }
                    if($(this).find('.tableHead').length>0){
                        var str="<a class='a_print vip vip_func' href='javascript:void(0)' onclick=\"printPreview('body .list',this)\">打印</a>";
                        $(this).find('.tableHead').append(str);
                    }else if($(this).find('.tableOprate .left').length>0){
                        var str="<a class='button btn_blue vip vip_func btn_print' href='javascript:void(0)' onclick=\"printPreview('body .list',this)\">打印</a>";
                        $(this).find('.tableOprate .left').append(str);
                    }else if($(this).find('.tableOprate .th').length>0){
                        var str="<div class='left'><a class='button btn_blue vip vip_func btn_print' href='javascript:void(0)' onclick=\"printPreview('body .list',this)\">打印</a></div>";
                        $(this).find('.tableOprate .th').before(str);
                    }
                });
            }
        }
    }

    function htmlInitialize(selector){
        interceptA();
        showPrintBtn(selector);
        showVip();
        trHoverAndCheckAll();
        createDropBox(selector);
        $('.tableOprate .th,table .th').addClass('yahoo2');
    }

    function skinInitialize(){
        $('.dropSkinBox').find('#'+getCookie('bk_skin')).addClass('now_skin');
        $('.btn_skin').on('click',function(){
            $('.btn_skin').removeClass('now_skin');
            $(this).addClass('now_skin');
            setCookie('bk_skin',$(this).attr('id'));
            location.reload();
        });
    }

    function webSenderInitialize(){
        //实例化websend
        var pushurl=document.domain;
        var pushconfig=$('#pushconfig').text().split('##');
        newws(pushconfig[1],pushconfig[2],pushconfig[3],pushurl,pushconfig[0]);
        $('#pushconfig').text('');
    }

    function topSearchInitialize(){
        $('.top_search .inputlist li').on('hover',function(){
            $('.top_search .inputlist li').removeClass('activeobj');
            $(this).addClass('activeobj');
        });
        $('.top_search .inputlist li').on('click',function(){quickSearch();});
        $('.top_search #searchString').on('focus',function(){showInputlist(1);});
        $('.right').not('.top_search').on('click',function(){
            if(!$('.inputlist').is(':hidden')){
                showInputlist(0);
            }
        });
    }

    function adInitialize(){
        if(getCookie('isAd')==1){
           var lefttime=0;
            if(lefttime>3600){
                var interval=1000;
            }else{
                var interval=10;
            }
            getRemainTime(lefttime,interval,function(str){
                $('.tbox #remain h4,#remain_time').html(str);
            });
        }
    }

    function getRemainTime(lefttime,interval,callback){
        return $.timer(interval,function(timer){
            if(timer.runtimes==undefined){timer.runtimes=1}
            var nMS = lefttime*1000-timer.runtimes*interval;
            if (nMS>=0){
                var nD=Math.floor(nMS/(1000*60*60*24))%24;
                var nH=Math.floor(nMS/(1000*60*60))%24;
                var nM=Math.floor(nMS/(1000*60)) % 60;
                var nS=Math.floor(nMS/1000) % 60;
                if(nMS<=3600*1000){ //剩余一天出现毫秒
                   var nmS=nMS % 1000;
                }else{
                  var nmS=-1;
                }
                var str=(nD>0?nD+'天':'')+((nD>0||nH>=0)?nH+'时':'')+((nD||nH>0||nM>=0)?nM+'分':'')+((nD||nH||nM>0||nS>=0)?nS+'秒<br/>':'')+(nmS>=0?nmS+'毫秒':'');
                timer.runtimes++;
                callback&&callback(str);
            }else{
                timer.stop();
            }
        });
    }

    function trHoverAndCheckAll(){
        //选中列表行变色
        $(".list tr").mouseover(function(){
            $(this).addClass("currow");
        }).mouseout(function(){
            $(this).removeClass("currow");
        });
        //全选/取消
        $(".checkall,#check").click(function(){
            if($(this).attr("checked")=="checked"){
                setCheckbox(true,"");
                $('.checkall,#check').attr('checked','checked');
            }else{
                setCheckbox(false,"");
                $('.checkall,#check').attr('checked',false);
            }
        });      
    }

    function showVip(){
        //vip图标
        $('.vip').each(function(){
            if($(this).find('.vip_img').length==0){
                $(this).append('<img class="vip_img" title="VIP用户专享" align="bottom" src="/bangke/Public/Static/images/icon/vip.svg">');
            }
        });
        //vipFunc
        vipFunc();
    }

    function vipFunc(){
        if(''=='1'){
            return true;
        }
        $('.vip_func').each(function(){
            var _this=$(this);
            if(_this[0].tagName.toUpperCase()=='A'){
                _this.removeAttr('onclick');
                _this.attr('href','javascript:void(0)');
                _this.off();
                _this.on('click',function(){
                    alert('您是免费用户，暂未开通该功能，开通VIP增值服务即可使用该功能哦');
                    ToBuySpace();
                });
            }
        });
    }

    //启动任务定时器
    function startMission(){
        if(BKGlobal.mission){
           return false;
        }
        var bkMission=getCookie('bkMission');
        if(bkMission&&bkMission!=='stop'){
            BKGlobal.mission = $.timer(3000, window[bkMission]);
        }
    }

    function stopMission(){
        BKGlobal.mission.stop();
        $('.MissionBox').fadeOut();
    }

    function sendRedPack(){
        if($('.MissionBox').is(':hidden')){
            $('.MissionBox').find('.info').text('正在群发红包中').end().fadeIn();
        }
        $.ajax({
            type:'GET',
            url:"/bangke/Manage/Personal/doSendRedPackMission",
            error:function(XMLHttpRequest, textStatus, errorThrown){
                stopMission();
            },
            success:function(data){
                if(getCookie('bkMission')=='stop'||data.status==0){
                    stopMission();
                }
            }
        });
    }

    //image_tip
    function createImageTip(selector){
        var str="<div class='image_tip_div'><img src='"+$('.image_tip').attr('data-url')+"' /></div>";
        selector=selector||'';
        $(selector+' .image_tip').each(function(){
            var a=$(this).position().top;
            var b=$(this).position().left;

            var w=$(this).outerWidth();
            if($(this).parent().find('.image_tip_div').length==0){
              $(this).parent().append(str);
            }
            
            $(this).parent().find('.image_tip_div').css({
              'position':'fixed',
              'top':(a-20)+'px',
              'left':(b+w)+'px',
              'z-index':100,
              'display':'none'
            });
        });
    }

    /**
     * 下拉框按钮添加class="dropdownBtn" data-res="dropDateBox" id为dropDateBox的元素的innerHtml为下拉框内容 data-res必须页面级唯一  
     * @return {[type]} [description]
     */
    function createDropBox(selector){
        selector=selector||'';
        $(selector+' .dropdownBtn').each(function(){
            if($(this).attr('data-status')=='true'){
                return true;
            }
            var id=$(this).attr('data-res');
            var html=$('#'+id).html();
            var str="<div class='dropdownZone "+id+"'>"+html+"</div>";
            
            if($(this).parent().find('.'+id).length==0){
                $(this).parent().append(str);
            }
            var _box=$(this).parent().find('.'+id);
            _box.css({
              'z-index':100,
              'display':''
            });
            $(this).attr('data-status','true');
            $(this).on('click',function(e){
                var a=$(this).position().top;
                var b=$(this).position().left;
                var h=$(this).outerHeight();
                var s=$('.right').scrollTop();
                var d=$(this).attr('data-direction');
                var c={'left':(b)+'px'};
                if(d=='up'){
                  c['bottom']=($(window).height()-(a+h+s))+'px';
                }else{
                  c['top']=(a+h+s)+'px';
                }
                _box.css(c);

                _box.toggle();
                e.stopPropagation();
            });
            _box.on('click',function(e){
                e.stopPropagation();
            });
            $('.right').on('click',function(){
                _box.hide();
            });
            _box.on('close.dropBox',function(){
                _box.hide();
            });
            // $('#'+id).html('');
        });
    }
    
    //拦截a
    function interceptA(){   
        $('table a[href]').each(function(){
            var url= $(this).attr('href');
            var id =$(this).closest('table').attr('id');

            if((url.indexOf('/p/')>-1||url.indexOf('/cbp/')>-1||url.indexOf('/sp/')>-1||url.indexOf('/ssp/')>-1||url.indexOf('/sr/')>-1||url.indexOf('/si/')>-1||url.indexOf('/bp/')>-1||url.indexOf('/cp/')>-1||url.indexOf('/mp/')>-1)&&id){  //分页
                $(this).attr('href','javascript:void(0)');
                $(this).attr('data-url',url);

                $(this).on('click',function(){
                    $(this).closest('.list').removeAttr('data-status');
                    var  url=$(this).attr('data-url');
                    $('<div class="loadding-mask"></div><div class="loadding"></div>').appendTo($('#'+id).parent());
                    $('#'+id).parent().load(url+" #"+id,'',function(){
                        htmlInitialize();
                        history.pushState(null, '', url);
                    });
                });
            }
        });
    }

    function show_ad(){
        setCookie('Adnum',1);
        $.ajax({
            type:'GET',
            url:"/bangke/Manage/BaseData/showad", 
            success:function(data){
                $('.popwin_content').html(data);
                TINY.box.show({
                  html:$('.popwin_content').html(),
                  fixed:false,
                  close:0,
                  maskid:'blackmask',
                  maskopacity:40,
                  autohide:6,
                  maskclose:0,
                  openjs:function(){
                     
                  },
                  closejs:function(){
                    if(getCookie('is_login_first')==1){
                      show_welcome();
                    }
                  }
                });
                $('.popwin_content').html('');
            }
        });
    }

    function show_welcome(){
        var title="edogawap"+',欢迎您登陆邦客智能管家！当前门店：总店';
        showTBox(title,"/bangke/Manage/BaseData/loginInfo",'700px','',function(){
          m_changeTab();
          setCookie('is_login_first',0);
        },function(){
          show_birthNote();
        });
    }

    function show_birthNote(){
        if(""=='1'){ //生日提醒
            showTBox('今天生日的学员',"/bangke/Manage/Student/showStuList/type/3",'500px');
        }
    }

    function m_changeTab(){
        var li = $('.tab li');
        var ul = $('.tabcontent ul');
              
        li.mouseover(function(){
            var _this = $(this);
            var t = _this.index();
            li.removeClass();
            li.addClass('unactivetab');
            _this.removeClass('unactivetab');
            _this.addClass('activetab');
            ul.css('display','none');
            ul.eq(t).css('display','block');
        });

        $('.tabtitle').on('click',function(){
          $(this).parent().children('.tabcont').toggle();
        });
    }
  
    //图片上传  
    function g_AjxUploadImg(btn, img, hidPut,type,callback) {  
        new AjaxUpload(btn, {  
            action: "/bangke/Manage/Upload/upload",  
            data: {"type":type,"thumbWidth":btn.attr('data-width')||200,"thumbHeight":btn.attr('data-height')||200,"thumbType":btn.attr('data-type')||1},  
            name: 'userfile',  
            onSubmit: function(file, ext) {  
                if (!(ext && /^(jpg|JPG|png|PNG|gif|GIF)$/.test(ext))) {  
                  alert("您上传的图片格式不对，请重新选择！");  
                  return false;  
                }  
            },  
            onComplete: function(file, response) { 
                console.log(response); 
                response = JSON.parse(response);
                if (response&&response.error==0) {  //有文件路径，则上传成功
                    if(typeof(UploadImgCallBack)=="function"){
                        callback=UploadImgCallBack;
                    }
                    if(callback){
                        callback(response.url);
                    }else{
                        hidPut.val(response.url);  
                        img.attr("src",response.url); 
                    }

                    if($('.tbox:visible').length>0){
                        $(window).trigger('resize');
                    }
                }else {  
                    alert(response.message);
                }  
            }  
        });  
    }  


    //接收websender信息
    function show_msg(data){
        var url="/bangke/Manage/WebMsg/index";
        $.ajax({
            type:'POST', //表单提交类型
            url:url, //表单提交目标
            data:data,
            success:function(data){
                if(check_before_load(data)){
                    if(!data.info){  //直接echo 信息
                        TINY.box.reset();
                        showTBox('推送信息','','400px',"<div style='padding:20px'>"+data+"</div>");
                    }else if(data.info=='Function'){  //调用js函数
                        try {
                            // eval(data.data.functype+"("+data.data.funcdata+")");
                            callFunc(data.data.functype,[data.data.funcdata]);
                        } catch (e) {
                            console.error(e);
                        }
                    }
                }
              
            }
        });
    }

    function ToBuySpace(){
        setCookie('isbuy',1);
        // window.open("/bangke/Manage/Personal/index");
        window.open("/bangke/Manage/AppMarket/index");
    }

    function log(s){
        console.log(s);
    }

    function getCookie(name){
        var arr,reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)");
        if(arr=document.cookie.match(reg)){
            return unescape(arr[2]);
        }else{
            return null;
        }
    } 

    function setCookie(name,value,expiredays){
        if(!expiredays){
            document.cookie = name + "="+ escape (value) + ";path=/";
        }else{
            var exdate=new Date();
            exdate.setTime(exdate.getTime()+expiredays*24*3600*1000);
            document.cookie = name + "="+ value + ";expires="+exdate.toGMTString()+";path=/";
        }
        $(window).trigger("change."+name+".cookie");
    } 

    function Calendarset(obj,type){
        Calendar.setup({
          animation:false,
          weekNumbers: true,
          inputField : obj.id,
          trigger    : obj.id,
          dateFormat: type||"%Y-%m-%d",
          showTime: true,
          minuteStep: 1,
          onSelect   : function() {this.hide();}
        });
        obj.click();
    }

    function showConfirm(title,msg,btns,openjs,closejs,ajaxCallBack,options){
        var html="<div style='font-size:14px;padding:10px;'>"+msg+"</div><div style='text-align:center;'>";
        for(i in btns){
            TINY.box.callback={};
            TINY.box.callback.i=btns[i].func||'';
            html+="<a href='javascript:void(0)' class='button btn_blue' style='margin:5px;' id='"+btns[i].id+"' onclick="+(TINY.box.callback.i)+">"+btns[i].value+"</a>"
        }
        html+="</div>";
        showTBox(title,'',"500px",html,openjs,closejs,ajaxCallBack,options);
    }

    function showTBox(title,url,minWH,content,openjs,closejs,ajaxCallBack,options) {
        var width=minWH.split(',')[0];
        var height=minWH.split(',')[1];
        $('#popwin_box .popwin_content').css('min-width',width||'40vw');
        $('#popwin_box .popwin_content').css('min-height',height||"0");
        
        if(title=='TitleClose'){
            $('#popwin_box .popwin_title').css('display','none');
        }else{
            $('#popwin_box .popwin_title').css('display','block');
            $('#popwin_box .popwin_title').html(title);
        }
        var tag=1;
        tboxInit=undefined;
        if(content){
            $('#popwin_box .popwin_content').html(content);
        }else{
            //缓存url
            TINY.box.url=url;
            log(url);
            $.ajax({
                type:'GET', //表单提交类型
                url:url, //表单提交目标
                async:false,
                beforeSend: function(data) {
                    submit_before_info();
                },
                success:function(data){
                    if(ajaxCallBack){
                        tag=ajaxCallBack(data);
                    }else{
                        if(check_before_load(data,true)){
                            $('#popwin_box .popwin_content').html(data);
                        }else{
                            tag=0;
                        }
                    }
                }
            });
        }
        if(tag){
            var _default={
                html:$("#popwin_box").html(),
                fixed:false,
                maskid:'blackmask',
                maskopacity:40,
                openjs:function(){
                    openfunc();
                    openjs&&openjs();
                },
                closejs:function(){
                    tboxInit=undefined;
                    closejs&&closejs();
                }
            };
            var options = $.extend(_default, options||{});
            TINY.box.show(options);
            $('#popwin_box .popwin_content').html('');
        }
    }

    function showTboxPage(obj){
        var url=$(obj).attr('data-url');
        $('<div class="loadding-mask"></div><div class="loadding"></div>').appendTo($('.tbox .popwin_content'));
        $.ajax({
            type:'GET', //表单提交类型
            url:url, //表单提交目标
            beforeSend: function(data) {
                submit_before_info();
            },
            success:function(data){
                //data.url = location.href;
                if(check_before_load(data)){
                    TINY.box.url=url;
                    $('.tbox .popwin_content').html(data);
                    $('.tbox .popwin_content').scrollTop(0); 
                    openfunc();
                    if(typeof(showTboxPageCallBack)=="function"){
                        showTboxPageCallBack();
                    }
                    TINY.box.resize();
                }
            }
        });
        return false;
    }

    function reloadTbox(url,data,func){
        url=url?url:TINY.box.url;
        if(data){
            TINY.box.url=url+'?'+dataToUrl(data).substr(1);
        }
        $('<div class="loadding-mask"></div><div class="loadding"></div>').appendTo($('.tbox .popwin_content'));
        $.ajax({
                type:'GET', //表单提交类型
                url:url, //表单提交目标
                data:data,
                beforeSend: function(data) {
                    submit_before_info();
                },
                success:function(data){
                    if(check_before_load(data)){
                        $('.tbox .popwin_content').html(data);
                        $('.tbox .popwin_content').scrollTop(0); 
                        openfunc();
                        func&&func();
                        TINY.box.resize();
                    }
                }
        });
        return false;
    }

  /**
   * param 将要转为URL参数字符串的对象
   * key URL参数字符串的前缀
   * encode true/false 是否进行URL编码,默认为true
   * 
   * return URL参数字符串  &....
   */
    function dataToUrl(param, key, encode) {
        if(param==null) return '';
        var paramStr = '';
        var t = typeof (param);
        if (t == 'string' || t == 'number' || t == 'boolean') {
          paramStr += '&' + key + '=' + ((encode==null||encode) ? encodeURIComponent(param) : param);
        } else {
          for (var i in param) {
            var k = key == null ? i : key + (param instanceof Array ? '[' + i + ']' : '.' + i);
            paramStr += dataToUrl(param[i], k, encode);
          }
        }
        return paramStr;
    }

    function alertInfo(str,time,func){
        if(str){
            $('.globalLoading').fadeIn(300).find('.info').text(str);
            if(time!=-1){
                BKGlobal.tid=window.setTimeout(function(){
                    $('.globalLoading').fadeOut(300);
                    func&&func();
                    BKGlobal.tid=0;
                },time||1500);
            }
        }
    }

    function openfunc(){
        $('.tbox .tinner').css('height','auto');
        $(window).on('resize',function(){
            if($('.tbox .tinner').height()<0.8*$(window).height()){
                $('.tbox .tinner').css('height','auto');
            }
        });
        if($('.tbox_unlimit:visible').length>0){
            $('.tbox .tinner').css('width','auto');
        }
        $('.tbox img,.tbox vedio').on('load',function(){
            $(window).resize();
        });
        htmlInitialize('.tbox ');
        tboxInit&&tboxInit();
    }

    function isEnter(event){
        var cur_pos;
        if($('.inputlist').find('.activeobj').length>0){
            cur_pos=$('.inputlist').find('.activeobj').index();
        }else{
            cur_pos=-1;
        }

        var e = event || window.event || arguments.callee.caller.arguments[0];
        var max=$('.inputlist li').length-1;

        if(e && e.keyCode==38){ // up 
            if(cur_pos==-1||cur_pos==0){
                cur_pos=max;
            }else{
                cur_pos--;
            }     
                
            $('.inputlist li').removeClass('activeobj');       
            $('.inputlist').find('li').eq(cur_pos).addClass('activeobj');       
        }

        if(e && e.keyCode==40){ // down
            if(cur_pos==max){
                cur_pos=0;
            }else{
                cur_pos++;
            }   
            $('.inputlist li').removeClass('activeobj');       
            $('.inputlist').find('li').eq(cur_pos).addClass('activeobj'); 
        }

        if(e && e.keyCode==13){ // Enter
            quickSearch();
        }
    }

    function showInputlist(type){
        var str=$.trim($('#searchString').val());
        $('.searchstr').text(str);
        if(type&&str){
            $('.inputlist').show();
        }else{
            $('.inputlist').hide();
        }
    }

    var preSearchString='';
    var preSearchType='';
    function quickSearch(){
        var s=$.trim($('#searchString').val());
        if(!s){
            $('.searchBox').find('.searchResult').html('').end().hide();
            return false;
        }

        var t=$('.inputlist').find('.activeobj').attr('data-type');
        if(preSearchString==s&&preSearchType==t){
            return false;
        }
        if(!t){
            return false;
        }
        preSearchString=s;
        preSearchType=t;
        $.ajax({
            type:'GET', 
            url:"/bangke/Manage/BaseData/searchEveryThing", 
            data:{'searchString':t+'##'+s},
            success:function(data){
                if(data.status==0){
                    $('.searchBox').find('.searchResult').html('').end().hide();
                    alertInfo(data.info);
                }else{
                    $('.searchBox').find('.searchResult').html(data).end().show();
                }
            }
        });
    }

    function printPreview(selector,obj){
        if($(selector).length>1){
          var _obj=$(obj).closest(selector);
        }else{
          var _obj=$(selector);
        }
        _obj.jqprint({
            handleHtml:function(html){
                var $html=$(html);
                $html.find('td>a').not('.btn_print,.a_print').each(function(){
                    if($(this).parent().children().length>1){
                        $(this).removeAttr("href");
                    }else{
                        $(this).parent().html($(this).parent().text());
                    }
                });
                $html.find('.tableOprate').hide();
                $html.find('.a_print,.btn_print').hide();
                return $html.prop('outerHTML');
            }
        });
    }

    function sendCode(btn,mobile,url,type) {
        if(mobile==''||mobile.length!=11){
            alertInfo('请输入正确的手机号');
            return false;
        }
        var wait=btn.getAttribute('data-wait');
        if(wait==60){
            $.ajax({
                type:'post', //表单提交类型
                url:url, //表单提交目标
                data:{'mobile':mobile,'type':type}, //表单数据
                success:function(data){
                    if(data.status==1){
                        changeBtn(btn);
                    }
                }
            });
        }
    }

    function changeBtn(btn){
        var wait=btn.getAttribute('data-wait');
        if (wait == 0) {
            btn.removeAttribute("disabled");
            btn.value = "重新获取";
            wait = 60;
        }else{
            btn.setAttribute("disabled", true);
            wait--;
            btn.setAttribute('data-wait',wait);
            btn.value = wait;
            setTimeout(function () {changeBtn(btn);},1000)//递归调用自身，刷新value
        } 
    }

    function form_ajax(obj,reload){
        $.ajax({
            type:$(obj).attr('method'), //表单提交类型
            url:$(obj).attr('action'), //表单提交目标
            data:$(obj).serialize(), //表单数据
            beforeSend: function(data) {
                submit_before_info();
            },
            success:function(data){
                submit_back_info(data);
                reload&&location.reload();
            }
        });
        return false;
    }

</script>

</head>
<body class="showmenu">
<div class="searchBox" style="display:none">
  <div class="searchBoxClose" onclick="$('.searchBox').hide()"></div>
  <div class="searchResult"></div>
</div>
<div style="display:none" id="pushconfig"></div>

<!-- 弹窗——重要结果提示框 -->
<div class="popwin" id="popwin_resultForm">
    <p class="popwin_title">
        #title#
    </p>
    <div class="popwin_content" style="overflow-y:auto;padding:15px;max-height:500px;text-align:center">
        <p class="popwin_tips popwin_tips_confirm">#content#</p>
        <a class="button btn_green" onclick="TINY.box.hide();" style="margin:10px 0px">确认</a>
    </div>
</div>

<!-- 弹窗——确认框 -->
<div class="popwin" id="popwin_confirmForm">
    <p class="popwin_title">
        #title#
    </p>
    <div class="popwin_content" style="text-align:center;">
        <p class="popwin_tips popwin_tips_confirm">#content#</p>
        <a class="button btn_gray  popwin_confirm submit">确认</a>
        <a class="button btn_red  popwin_cancel" onclick="TINY.box.hide();">取消</a>
    </div>
</div>

<!-- 弹窗——删除确认 -->
<div class="popwin" id="popwin_deleteForm">
    <p class="popwin_title">
        #title#
    </p>
    <div class="popwin_content" style="text-align: center">
        <img class="mgb10" src="index_files/popwin_eroteme.png">
        <p class="popwin_tips popwin_tips_delete">#content#</p>
        <a class="button btn_red popwin_confirm submit">确认</a>
        <a class="button btn_gray popwin_cancel" onclick="TINY.box.hide();">取消</a>
    </div>
</div>

<div class="popwin" id="popwin_box">
    <p class="popwin_title">TITLE</p>
    <div class="popwin_container">
        <div class="popwin_content">
          正文
        </div>
    </div>
</div>
<div id="allFunc_box" style="display:none"> 
    <dl><dt>快捷键F1</dt></dl>  
    <dl>
        <dt>
            基础数据管理        </dt>
        <dd>
            <a href="http://localhost/bangke/Manage/Student/index" target="_blank" title="学员管理">学员管理</a><a href="http://localhost/bangke/Manage/Teacher/index" target="_blank" title="老师管理">老师管理</a><a href="http://localhost/bangke/Manage/Salesman/index" target="_blank" title="销售员管理">销售员管理</a><a href="http://localhost/bangke/Manage/Store/index" target="_blank" title="门店管理">门店管理</a>        </dd>
    </dl><dl>
        <dt>
            教务管理        </dt>
        <dd>
            <a href="http://localhost/bangke/Manage/ClassRoom/index" target="_blank" title="教室管理">教室管理</a><a href="http://localhost/bangke/Manage/Course/index" target="_blank" title="课程管理">课程管理</a><a href="http://localhost/bangke/Manage/Booking/confirm" target="_blank" title="班级排课管理">班级排课管理</a><a href="http://localhost/bangke/Manage/Index/index" target="_blank" title="上课签到">上课签到</a><a href="http://localhost/bangke/Manage/Service/index" target="_blank" title="服务卡管理">服务卡管理</a>        </dd>
    </dl><dl>
        <dt>
            财务管理        </dt>
        <dd>
            <a href="http://localhost/bangke/Manage/Teacher/settlement" target="_blank" title="老师工资结算">老师工资结算</a><a href="http://localhost/bangke/Manage/Salesman/settlement" target="_blank" title="销售工资结算">销售工资结算</a><a href="http://localhost/bangke/Manage/Finance/allStatic" target="_blank" title="财务统计">财务统计</a><a href="http://localhost/bangke/Manage/Finance/in" target="_blank" title="收支记账">收支记账</a><a href="http://localhost/bangke/Manage/CheckStand/checkStand" target="_blank" title="收银台">收银台</a>        </dd>
    </dl><dl>
        <dt>
            招生管理        </dt>
        <dd>
            <a href="http://localhost/bangke/Manage/SignUp/index" target="_blank" title="招生统计">招生统计</a><a href="http://localhost/bangke/Manage/SignUp/storecourse" target="_blank" title="微招生设置">微招生设置</a><a href="http://localhost/bangke/WeChat/AppMarket/addPoster" target="_blank" title="招生海报设置">招生海报设置</a><a href="http://localhost/bangke/Manage/Article/index" target="_blank" title="文章管理">文章管理</a>        </dd>
    </dl><dl>
        <dt>
            系统日志管理        </dt>
        <dd>
            <a href="http://localhost/bangke/Manage/Static/operationRecord" target="_blank" title="操作日志">操作日志</a><a href="http://localhost/bangke/Manage/Static/course_buy" target="_blank" title="课程购买记录">课程购买记录</a><a href="http://localhost/bangke/Manage/Static/service_buy" target="_blank" title="服务购买记录">服务购买记录</a><a href="http://localhost/bangke/Manage/Static/noticeList" target="_blank" title="通知记录">通知记录</a><a href="http://localhost/bangke/Manage/Static/studentStatic" target="_blank" title="报表">报表</a>        </dd>
    </dl><dl>
        <dt>
            商品进销存管理        </dt>
        <dd>
            <a href="http://localhost/bangke/Manage/Index/loginSmpss" target="_blank" title="商品管理系统">商品管理系统</a><a href="http://localhost/bangke/Manage/OLStoreGoods/index" target="_blank" title="微信商城">微信商城</a>        </dd>
    </dl></div>
<div id="webMsg_box" style="display:none">
    <div class="interactiveWallBox">
        <div class="headImgDiv">
            <img class="headImg" src="" data-src="_HEADIMGURL_" alt="">
        </div>
        <div class="msgDiv">
            <h4>_NICKNAME_ <span class="rightspan timestr" style="font-size:12px;">_DATE_</span></h4>
            <pre class="intropre">_MSG_</pre>
        </div> 
        <div class="reply">
            <textarea maxlength="100" id="reply"></textarea>
            <input class="button btn_blue" id="reply_btn" value="回复" type="button">
        </div>
    </div> 
</div>

<div id="player" style="display: none"></div>
<div class="globalLoading" style="display:none;"><span class="info">载入中...</span></div>

<div class="MissionBox"><div class="loading"></div><span class="info"></span></div>

<div class="pagemask"></div>
<div class="top_head">
    <div class="top_search">
        <input class="input_large" id="searchString" placeholder="搜点什么(F)" onkeydown="return isEnter(event)" onkeyup="showInputlist(1);" type="text">
        <div class="inputlist">
            <ul>
              <li class="activeobj" data-type="student">搜索<span class="searchstr"></span>相关的学员</li>
              <li data-type="teacher">搜索<span class="searchstr"></span>相关的老师</li>
              <li data-type="course">搜索<span class="searchstr"></span>相关的课程</li>
              <li data-type="store">搜索<span class="searchstr"></span>相关的门店</li>
              <li data-type="class">搜索<span class="searchstr"></span>相关的班级</li>
            </ul>
        </div>
    </div>
	  <div class="top_link">
      <ul>
                <li id="i_self"> 广外琴行1【总店】：你好！&nbsp;edogawap</li>
        <li><a href="javascript:void(0)" onclick="showShortMsgList()"> <span class="glyphicon glyphicon-envelope" aria-hidden="true"></span></a></li>
        <li><a target="_blank" href="http://qinhang.dsmake.com/">官网首页</a></li>
        <li>|</li>
        <li><a target="_blank" href="http://bangkebbs.dsmake.com/">邦客问答百科</a></li>
		<li>|</li>
        <li id="i_exit"><a href="http://localhost/bangke/Manage/Login/logout">退出</a></li>		
      </ul>
    </div>
</div>
<!-- header end -->

<div class="leftmenu">
<div class="top_logo"> <img src="index_files/logo.png"> </div>
<!-- <div class="top_logo" onclick="ToBuySpace()"> <img src="/bangke/Public/Static/images/main/logo1111.png" /><span id="remain_time" style="color:white"></span> </div> -->
<div class="span"></div>
<div class="menu" id="menu">
<div>
	<img src="index_files/cygn.png">
</div>

<div id="items_usual">
    <ul>
        <li id="allFuncBtn"><a class="hollow_button" href="http://localhost/bangke/Manage/Index/allFunction">功能大全(F1)</a></li>

        <li><a class="hollow_button" href="http://localhost/bangke/Manage/Index/index">上课签到</a></li>

        <li><a class="hollow_button" href="http://localhost/bangke/Manage/Booking/confirm">班级排课</a></li>

        <li><a class="hollow_button active" href="http://localhost/bangke/Manage/CheckStand/checkStand">收银台</a></li> 

        <li><a class="hollow_button" href="http://localhost/bangke/Manage/SignUp/index">招生</a>
        </li>
        <li>
          <a class="hollow_button" href="http://localhost/bangke/Manage/WebMsg/interactiveWall">微信互动<sup id="wechatNewsCount" style="display: none">&nbsp;<i class="redpoint"></i></sup></a>
        </li>
        <li><a class="hollow_button" href="http://localhost/bangke/Manage/AppMarket/index">应用市场</a></li>
    </ul>
</div>
<div id="items_other">
	<ul>
      <li><a class="hollow_button" id="Personal" href="http://localhost/bangke/Manage/Personal/index">我的账户</a></li>
  		  <li><a class="hollow_button" id="Personal" href="http://localhost/bangke/Manage/Personal/wallet">我的钱包</a></li>
    
        <li><a class="hollow_button" id="Rbac" href="http://localhost/bangke/Manage/Rbac/index">系统设置</a></li>        <li><a class="hollow_button" id="Guestbook" href="http://localhost/bangke/Manage/Guestbook/index">留言反馈</a></li>
    </ul>
</div>

</div>
</div>
<!-- leftmenu end -->

<!--客服固定框-->
  <div id="haiiskefu">
  <div class="kfleft" title="consult"></div>
	<ul>
		<li><a rel="nofollow" href="http://wpa.qq.com/msgrd?v=3&amp;uin=2244346598&amp;site=qq&amp;menu=yes" title="" target="_blank"></a></li>
		<li><a rel="nofollow" href="http://wpa.qq.com/msgrd?v=3&amp;uin=2244346598&amp;site=qq&amp;menu=yes" title="" target="_blank"></a></li>
		<li><a rel="nofollow" href="http://wpa.qq.com/msgrd?v=3&amp;uin=2244346598&amp;site=qq&amp;menu=yes" title="" target="_blank"></a></li>
	</ul>
  </div>
  <!--客服固定框 结束-->

<div class="right">
	<div class="rightContent">


    <link rel="stylesheet" type="text/css" href="index_files/jscal2.css">
    <link rel="stylesheet" type="text/css" href="index_files/border-radius.css">
    <link rel="stylesheet" type="text/css" href="index_files/win2k.css">
    <script type="text/javascript" src="index_files/calendar.js"></script>
    <script type="text/javascript" src="index_files/en.js"></script>
    <script type="text/javascript" src="index_files/bootstrap3-typeahead.js"></script>
<div id="barCode">
  <img src="index_files/delete.png" style="width:20px;height:20px" onclick="delBarCode(this)">
  <div class="codePng"><img src="index_files/barcode.png" alt=""></div>
  <div>&nbsp;&nbsp;</div>
  <span style="color:red;">用手机打开收银台扫描条形码，将商品加入订单（该条形码仅供测试，请以商品条形码为准）<br><a href="javascript:void(0)" onclick="setCookie('hbcode',1,3600);$(this).parent().parent().remove();">不再显示</a></span>
</div><style>
    .li-info li{
        display: inline-block;
        line-height: 24px;
        padding:5px 20px;
    }
</style>
<div class="main">
    <div class="stu_info_top">
        <a class="navigation_bar" href="http://localhost/bangke/Manage/Index/allFunction">功能大全</a><span class="navigation_bar">&gt;&gt;</span><a class="navigation_bar" href="http://localhost/bangke/Manage/CheckStand/checkStand">收银台</a>
    </div>
    <div class="pos">收银台 |  <a href="http://localhost/bangke/Manage/CheckStand/orderList" id="orderList" class="button btn_blue">订单记录</a> | <a href="http://localhost/bangke/Manage/Finance/allStatic" class="button btn_blue">财务统计</a><a class="tutorial_btn" href="javascript:void(0)" onclick="tutorial()" id="tutorial_btn">怎么用？</a></div>
    <div id="checkStand">
        <!-- <a href="javascript:void(0);" class="rightspan btn" id="fullscreen" style="font-size:14px;outline: none;" onclick="checkStandFullScreen()">全屏</a> -->
        <div class="col-xs-12 text-center">
            <ul class="li-info">
                <li>今日商品收入：0</li>
                <li>今日教学收入：0</li>
                <li>今日已签课次：0</li>
                <li>今日未签课次：0</li>
            </ul>
        </div>  
        <div class="form">
            <h4>收银台</h4>
            <form method="post" id="form_do_add" name="form_do_add" action="/bangke/Manage/CheckStand/outOrder">
                <div id="oprate">
                    <dl id="storeAndRecharge">
                        <dt> 所属门店：</dt>
                        <dd>
                            <select name="s_id" id="s_id" class="select" onchange="changeStore()">
                                                            </select>
                        </dd>
                        <dd style="float: right;">
                            <a href="javascript:void(0)" class="button btn_blue" onclick="show_student_article('/bangke/Manage/Student/fastRegister')">会员登记</a>
                            <a href="javascript:void(0)" class="button btn_blue" onclick="show_recharge_article('/bangke/Manage/Student/recharge/type/0')">会员充值</a>
                            <a href="javascript:void(0)" class="button btn_blue" onclick="show_goods_article('/bangke/Manage/CheckStand/addGoods')">添加商品</a>
                            <a href="javascript:void(0)" class="button btn_blue" onclick="show_checkIn_article('/bangke/Manage/CheckStand/checkIn')">商品入库</a>
                            <a href="javascript:void(0)" class="button btn_blue" onclick="show_return_article('/bangke/Manage/CheckStand/goodsReturn')">退货</a>
                            <a href="javascript:void(0)" class="button btn_blue dropdownBtn" data-res="dropListBox" data-status="true">租赁<span class="caret" style="border-top-color:white"></span></a>
                            <a href="javascript:void(0)" class="button btn_blue vip vip_func">库存调货<img class="vip_img" title="VIP用户专享" src="index_files/vip.svg" align="bottom"></a>
                        <div class="dropdownZone dropListBox" style="z-index: 100;">
        <ul class="drop-menu-list">
            <li><a href="javascript:void(0)" onclick="show_tenancy_article('/bangke/Manage/CheckStand/goodsTenancy')">租赁</a></li>
            <li><a href="javascript:void(0)" onclick="show_back_article('/bangke/Manage/CheckStand/goodsBack')">归还</a></li>
            <li><a href="javascript:void(0)" onclick="show_tenancyList_article('/bangke/Manage/CheckStand/tenancyList')">列表</a></li>
        </ul>
    </div></dd>
                    </dl>
                    <dl id="goodsAndService">
                        <dt> 选择商品：</dt>
                        <dd>
                             <a class="button btn_blue" onclick="show_goodsList_article('/bangke/Manage/CheckStand/goodsList')">选择商品</a>
                        </dd>
                        <dt style=" margin-left:120px;">选择课程：</dt>
                        <dd>
                           <a class="button btn_blue" onclick="show_course_article('/bangke/Manage/Student/orderBuy')">选择课程</a>
                        </dd>
                        <dt style=" margin-left:120px;">选择服务：</dt>
                        <dd>
                            <a class="button btn_blue" onclick="show_service_article('/bangke/Manage/Service/orderBuy')">选择服务</a>
                        </dd>
                    </dl>
                </div>
                <br>
                <div class="list" id="ordercar">
                    <table class="" width="100%">
                        <tbody><tr class="">
                            <th>名称</th>
                            <th>数量</th>
                            <th>单价</th>
                            <th>折扣</th>
                            <th>优惠金额</th>
                            <th></th>
                        </tr>
                        
                        
                        
                        <tr class="">
                            <th></th>
                            <th></th>
                            <th>总价：0</th>
                            <th>优惠：0</th>
                            <th>小计：0</th>
                            <th></th>
                        </tr>
                    </tbody></table>
                </div>
                <br>
                <br>
                <div id="info">
                    <dl id="studentAndSaleman" style="position: relative;overflow: visible;display:table">
                        <dt> 选择会员：</dt>
                        <dd>

                        <input id="stu_id" name="stu_id" data-provide="typeahead" placeholder="按姓名，编号，手机搜索" class="input" autocomplete="off" type="text">
                                                </dd>

                        <dt style=" margin-left:62px;"> 选择销售员：</dt>
                        <dd>
                            <select name="salesman_id" class="select">
                                <option value="" selected="selected">选择销售员</option>
                                                            </select>
                        </dd>
                        <dt style=" margin-left:62px;"> 经手人：</dt>
                        <dd>
                            <input class="input" name="co_handler" id="co_handler" value="edogawap" maxlength="10" type="text">
                        </dd>
                    </dl>
                    <dl>
                        <dt> 备注：</dt>
                        <dd>
                            <textarea cols="150" rows="1" name="remark" id="remark" style="padding:5px 0px" maxlength="200"></textarea>
                        </dd>
                    </dl>
                    <dl>
                        <dt> 余额不足:</dt>
                        <dd>
                            <input name="option" value="0" checked="checked" type="radio">无法购买
                            <input name="option" value="1" type="radio">自动充值
                            <input name="option" value="2" type="radio">欠费购买
                        </dd>
                    </dl>
                </div>
                <div class="form text-center">
                    <input name="mt" value="in" type="hidden">
                    <input name="orderTotal" value="0" type="hidden">
                    <input name="orderDiscount" value="0" type="hidden">
                    <input name="orderRealTotal" value="0" type="hidden">
                    <input class="button btn_blue" id="submit" value="提交订单" type="submit">
                    <input class="button btn_green" onclick="delOrder();" value="清空订单" type="button">
                </div>

            </form>
        </div>
    </div>
    
    <div id="dropListBox" style="display: none">
        <ul class="drop-menu-list">
            <li><a href="javascript:void(0)" onclick="show_tenancy_article('/bangke/Manage/CheckStand/goodsTenancy')">租赁</a></li>
            <li><a href="javascript:void(0)" onclick="show_back_article('/bangke/Manage/CheckStand/goodsBack')">归还</a></li>
            <li><a href="javascript:void(0)" onclick="show_tenancyList_article('/bangke/Manage/CheckStand/tenancyList')">列表</a></li>
        </ul>
    </div>
</div>

<script type="text/javascript">
$(function(){
	$("#form_do_add").formSubmit(function(params){
        if(confirm("确定要提交订单吗？")){
            return params;
        }else{
            return false;
        }
    },function(data){
        if (data.status==1) {
            show_receipt_article(data.resultdata);
        }
    });

    onchangStudent('stu_id');
});
    
    function delBarCode(obj){
        $(obj).parent().css("display","none");
    }

    function changeStore(){
        var s_id=$("#s_id").val();

        var url = "/bangke/Manage/CheckStand/checkStand/s_id/s_id_val";
        url = url.replace('s_id_val',s_id);
        // alert(s_id);
        window.location.href=url;
    }

    function delOrder(){
        $.ajax({
            type:"POST", //表单提交类型
            url:"/bangke/Manage/CheckStand/clearOrder", //表单提交目标
            data:{s_id:$("#s_id").val()},
            beforeSend: function(data) {
                submit_before_info();
            },
            success:function(data){
                //data.url = location.href;
                submit_back_info(data);
                window.location.href=window.location.href;
            }
        });
    }

    //新手教程
    function tutorial(){  
        var enjoyhint_instance = new EnjoyHint({});
        var enjoyhint_script_steps = [
          {
            selector:'.right' ,
            description: '欢迎使用收银台功能，接下来将介绍本模块的基本操作。',
            showNext:true,
            justIntro:true,
            showSkip:true,
          },
          {
            selector:'#storeAndRecharge' ,
            description: '该区域可以选择收银台所在的门店，还可以对学员进行快速充值',
            showNext:true,
            showSkip:true,
            disablecontent:true,
            bottom:10
          },
          {
            selector:'#goodsAndService' ,
            description: '该区域可以选择学员购买的商品、课程以及服务',
            showNext:true,
            showSkip:true,
            disablecontent:true,

          },
          {
            selector:'#ordercar' ,
            description: '该区域为购物车的详情部分，展示了已经添加到购物车的商品、课程及服务',
            showNext:true,
            showSkip:true,
            disablecontent:true,            
          },
          {
            selector:'#studentAndSaleman' ,
            description: '该区域可以选择购买的学员，以及售货的销售员',
            showNext:true,
            showSkip:true,
            disablecontent:true,
            bottom:10
          },
          {
            selector:'#submit' ,
            description: '点击提交即可完成购买操作，系统自动弹出小票点击打印即可完成整个收银操作',
            showNext:true,
            showSkip:true,
            disablecontent:true
          },
          {
            selector:'#orderList' ,
            description: '点击可跳转至收银台订单列表，可以查看各个订单的详情，以及打印小票',
            showNext:true,
            showSkip:true,
            disablecontent:true
          },
          {
            selector:'#tutorial_btn' ,
            description: '点击此处可以再次查看此教程',
            showNext:true,
            showSkip:true,
            disablecontent:true,
          },
          {
            selector:'.right' ,
            description: '教程引导完毕，如果您有任何问题请与我们的客服联系。',
            showNext:true,
            justIntro:true,
            showSkip:true,
          }
          ];
        var steps=enjoyhint_script_steps;
        enjoyhint_instance.set(steps);
        enjoyhint_instance.run();
    }


    function onchangStudent(id){
        $('#'+id).typeahead({
            source: function (query, process) {
                $.ajax({
                    type:"POST", //表单提交类型
                    url:"/bangke/Manage/CheckStand/searchStudent", 
//表单提交目标
                    data:{s_id:$("#s_id").val(),key:query}, //表单数据
                    success:function(data){
                        students = [];
                        map = {};
                        var studentList = data.data.studentList;
                        $.each(studentList, function (i, student) {
                                map[student.stu_id] = student;
                                students.push(student.stu_id);
                        });
                        // alert(students);
                        process(students);
                    }
                });
            },
            items: 5,//最多显示个数
            matcher: function (item) {
                return item;
            },
            highlighter: function (item) {
               return 
"学
生："+map[item].stu_name+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
手
机："+map[item].stu_mobile+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
编号："+item+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;余
额："+map[item].stu_money;
            },
        });
    }

    function show_recharge_article(url,content,title) {
        
showTBox('充值',url,'450px','',function(){onchangStudent('pre_stu_id');});
    }

    function show_goodsList_article(url,type,goods_sn) {
        showTBox('选择商品',url,'560px','',function(){
            if(type){
                $('#goods_sn').val(goods_sn);
                showGoodsInfo(goods_sn);
                onchangGoodsSn();
            }else{
                onchangGoodsSn();
            }
                    });
    }

    function show_course_article(url) {
        showTBox('选择课程',url,'825px','',function(){
                    });
    }

    function show_service_article(url) {
        showTBox('选择服务',url,'765px','',function(){
                    });
    }

    function show_student_article(url) {
        showTBox('快速添加新会员',url,'765px');
    }

    function show_goods_article(url) {
        showTBox('快速添加商品',url,'780px');
    }

    function show_checkIn_article(url) {
        showTBox('商品入库',url,'440px','',function(){
            onchangGoodsSn(1);
        });
    }
    function show_changeStock_article(url) {
        showTBox('库存调货',url,'440px','',function(){
            changeGoods();
        });
    }
    function show_return_article(url) {
        showTBox('退货',url,'500px','',function(){
            changeOrderId(".tbox 
#orderid",{},function(item,selector,data,updater){
                
reloadTbox("/bangke/Manage/CheckStand/goodsReturn/orderid/"+item,'',function(){

                        changeOrderId(selector,data,updater);
                    });
            });
        });
    }
    function show_tenancy_article(url) {
        $('.dropListBox').trigger('close.dropBox');
        showTBox('租赁',url,'560px','',function(){
            onchangGoodsSn();
            onchangStudent('js-stu_id');
        });
    }
    function show_back_article(url) {
        $('.dropListBox').trigger('close.dropBox');
        showTBox('租赁归还',url,'500px','',function(){
            changeOrderId(".tbox 
#orderid",{'type':1},function(item,selector,data,updater){
                
reloadTbox("/bangke/Manage/CheckStand/goodsBack/orderid/"+item,'',function(){

                        changeOrderId(selector,data,updater);
                    });
            });
        });
    }
    function show_tenancyList_article(url) {
        $('.dropListBox').trigger('close.dropBox');
        showTBox('租赁列表',url,'900px');
    }
    function changeOrderId(selector,data,updater){
        $(selector).typeahead({
            source: function (query, process) {
                $.ajax({
                    type:"POST", //表单提交类型
                    url:"/bangke/Manage/CheckStand/searchOrderId", 
//表单提交目标
                    data:$.extend(data||{},{key:query}), //表单数据
                    success:function(data){
                        if(!data){
                            $('.typeahead').hide();
                            return;
                        }
                        ids = [];
                        map = {};
                        $.each(data, function (i, value) {
                                map[value] = value;
                                ids.push(value);
                        });
                        // alert(students);
                        process(ids);
                    }
                });
            },
            items: 5,//最多显示个数
            updater: function (item) {
                updater&&updater(item,selector,data,updater);
                return item;
            },
            matcher: function (item) {
                return item;
            },
            highlighter: function (item) {
                var text="订单号："+item;
                return text;
            },
        });
    }

    function changeGoods(){
        $("#goods_sn").typeahead({
            source: function (query, process) {
                $.ajax({
                    type:"POST", //表单提交类型
                    url:"/bangke/Manage/CheckStand/searchGoods", 
//表单提交目标
                    data:{s_id:$(".tbox #s_from").val(),key:query}, 
//表单数据
                    success:function(data){
                        if(!data.data.goodsList){
                            $('.typeahead').hide();
                            return;
                        }
                        students = [];
                        map = {};
                        var studentList = data.data.goodsList;
                        $.each(studentList, function (i, student) {
                                map[student.goods_sn] = student;
                                students.push(student.goods_sn);
                        });
                        // alert(students);
                        process(students);
                    }
                });
            },
            items: 10,//最多显示个数
            updater: function (item) {
                $('.tbox #goods_name').val(map[item].goods_name||'');
                $('.tbox #stock').text(map[item].stockNum||0);
                return item;
            },
            matcher: function (item) {
                return item;
            },
            highlighter: function (item) {
                var text="";
                if (map[item].stockNum==null) {
                    
text="条形码："+map[item].goods_sn+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&
nbsp;&nbsp;&nbsp;名
称："+map[item].goods_name+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
库存：0";
                }else{
                    
text="条形码："+map[item].goods_sn+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&
nbsp;&nbsp;&nbsp;名
称："+map[item].goods_name+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
售
价："+map[item].out_price+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
库存："+map[item].stockNum;
                }
               return text;
            },
        });
    }

    function show_receipt_article(url) {
        
showTBox('收据/小票',url,'400px','','',function(){location.reload()});
    }

    function onchangGoodsSn(type){
        $("#goods_sn").typeahead({
            source: function (query, process) {
                $.ajax({
                    type:"POST", //表单提交类型
                    url:"/bangke/Manage/CheckStand/searchGoods", 
//表单提交目标
                    data:{s_id:$("#s_id").val(),key:query}, //表单数据
                    success:function(data){
                        if(!data.data.goodsList){
                            $('.typeahead').hide();
                            return;
                        }
                        students = [];
                        map = {};
                        var studentList = data.data.goodsList;
                        $.each(studentList, function (i, student) {
                                map[student.goods_sn] = student;
                                students.push(student.goods_sn);
                        });
                        // alert(students);
                        process(students);
                    }
                });
            },
            items: 10,//最多显示个数
            updater: function (item) {
                if(type){
                    $('.tbox 
#goods_name').val(map[item].goods_name||'');
                    $('.tbox #stock').text(map[item].stockNum||0);
                    // $('.tbox #price').val(map[item].out_price||0);
                }else{
                    
this.$element.parent().children("input").last().attr('value',item);
                    $('.tbox #name').val(map[item].goods_name||'');
                    $('.tbox #price').val(map[item].out_price||0);
                    $('.tbox 
#price').attr('data-value',map[item].out_price||0);
                    $('.tbox #stock').text(map[item].stockNum||0);
                    countPrice();
                }
                
                return item;
            },
            matcher: function (item) {
                return item;
            },
            highlighter: function (item) {
                var text="";
                if (map[item].stockNum==null) {
                    
text="条形码："+map[item].goods_sn+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&
nbsp;&nbsp;&nbsp;名
称："+map[item].goods_name+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
库存：0";
                }else{
                    
text="条形码："+map[item].goods_sn+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&
nbsp;&nbsp;&nbsp;名
称："+map[item].goods_name+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
售
价："+map[item].out_price+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
库存："+map[item].stockNum;
                }
               return text;
            },
        });
    }

    // 电脑手机联动函数
    function goodsSnInput(goods_sn){
        if($('#goods_sn').length<=0){
            
show_goodsList_article("/bangke/Manage/CheckStand/goodsList",1,goods_sn);

        }else{
            $('#goods_sn').val(goods_sn);
            showGoodsInfo(goods_sn);
        }
    }

    function showGoodsInfo(goods_sn){
        $.ajax({
            type:"POST", //表单提交类型
            url:"/bangke/Manage/CheckStand/searchGoods", //表单提交目标
            data:{s_id:$("#s_id").val(),key:goods_sn}, //表单数据
            success:function(data){
                if(data.data.goodsList!=null){
                   $('.tbox 
#name').val(data.data.goodsList[0].goods_name||'');
                   $('.tbox 
#price').val(data.data.goodsList[0].out_price||0);
                   $('.tbox 
#stock').text(data.data.goodsList[0].stockNum||0);
                }else{
                   $('.tbox #error').text('该商品不存在');
                }
            }
        });
    }
    
    // 电脑手机联动函数
    function stu_idInput(stu_id){
        $('#stu_id').val(stu_id);
        $('#pre_stu_id').val(stu_id);
    }


</script>
	</div>    
</div>
<script type="text/javascript">
    $(function() {
      //实现客服固定框滑动效果
    $(".kfleft").click(function(){
		
    var i=$("#haiiskefu").css("right");
    if (i=='0px'){
      $('#haiiskefu').animate({right:-80}, 200);
	  $("#haiiskefu ul").fadeOut(200);
    } else {
      $('#haiiskefu').animate({right:0}, 200);
	  $("#haiiskefu ul").fadeIn(200);
    }
  });
  });

</script>
<script type="text/javascript" src="index_files/common.js"></script>
<script type="text/javascript" src="index_files/frame.js"></script>
<script type="text/javascript" src="index_files/ajax-submit.js"></script>
<script type="text/javascript" src="index_files/tinybox.js"></script>
<script type="text/javascript" src="index_files/jquery.js"></script>

</body></html>